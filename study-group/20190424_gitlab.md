# GitLab Meetup Tokyo

## 今後

- 5/22 -23 Gitlab hacasonがある
- https://gitlab-jp.herokuapp.com
- Facebook, Youtube, QiitaGitlab jp

## GitLabでできること＆GitLab 12.0の改善点

- 体系だった本が必要だったGitlab実践ガイドがおすすめ
- 昨日の一覧が欲しい場合
  - https://about.gitlab.com/features/
- GitLabのアドバンテージ
  - DebOps
  - Gitlabでは様々なツールを入れなきゃいけないことが１つのサービスで実現できる

- GithubへのCI/CDを無料でサポート
- SaaS vs Self-Host
  - 手軽に始められる.com管理不要 2000分/つき
    - 自分のRunnersも利用可能
  - セルフホスティング
    - 国内データセンター自社クラウド
    - クラウドネイティブデプロイ: Production-read: GKE
- 毎月リリースがある
  - グループk8sクラスタ
  - Auto DevOps
    - 数千行になるYAMLをテンプレート機能を用いてコンパクトにすることができる
    - APM(アプリケーション監視)
    - その他のモニタリングができるようになった
- 12.x
  - 6/22にリリースされる
  - 特別に新しい機能があるわけではない
  - 古いLinuxなどのサポートが終了する
  - 毎月22日のアップデートの１つとして捉えてしまって良い
  - 12ヶ月ごとにメジャーアップデートをすることになった


## 共有、自動化、計測 -DevOpsツール考察-

- devopsとはなんぞや
  - 歴史
    - DEV(多くても数回のリリース)
    - OPS(静的な環境の運用)
    - 2001年 アジャイルソフトウェア開発宣言
      - 頻繁なリリース
        - 運用が死ぬという事実
    - 2008年 アジャイルを考えるにあたってDEVだけではなくOPSも気にしなくてはならない
    - 2009年
      - DevOpsという単語でVelocity Conferenceでの公園
      - dev <-> Ops が協力関係が作られているから
      - DevOpsDay開催
  - アジャイル開発のような動的な環境変化に対してうまく対処できるよう組織が協力し合うための文化運動
  - ウォーターフォール
    - 一度仕様を決めたらそのあと大きな変更がない
  - アジャイル
    - ビジネスの状況に応じて仕様を柔軟に変えていく
  - デジタルトランスフォーメーションの波がDevOpsの重要性を高めている
  - DevOpsというチームやロールはない
    - SRE (DevOpsから派生した考え方)
  - DevとOpsだけではなくゴールを共有する人、全てが関係者
  - 最終形態は存在せず継続できなプロセスがDevOps
  - なんのツールを使っているかではなく、どのようにツールを使っているかが重要
  - DevOpsの成熟度を測る評価基準が存在している

- DevOpsのツールの関係
  - ツールの導入が文化の定着していることの十分条件にはならない。ツールでは問題のある文化を修正できない
  - GitLabのツールなのでどのように活用するかが重要

- 共有のためのツール
  - 目的
    - チームの中での透明性がまし、チーム内に信頼が生まれる
    - 誰かが重大なミスをする前に防止策を伝えられる
    - チーム間での情報共有によりイノベーションが促進される
      - ヒューマンエラーは個人的なものではなく構造的なものとして捉える

- 自動化のためのツール
  - ヒューマンエラーの削減による成果物の品質向上
  - IoCの実装によるアプリケーション開発手法

- 計測のためのツール
  - 計測の目的
    - OODAループを回し、状況に柔軟に対応する(Observerに相当)
    - O (Observer) 監視
    - O 状況判断
    - D 意思決定
    - A Action 行動
  - DevOps 計測のチャレンジ(1) ロール間で計測したい内容が異なる

## GitLab Runner autoscaling

- ピクシブのCI事情
  - githubとgitlab(オンプレ)が使われている
  - CIの問題点
    - ビルドの時間がかかっていた
      - ビルド1回に100分時間がかかっていた
      - AWS 月300から500ドル
      - ほぼほぼEC2インスタンス
  - スポットインスタンス
    - EC2の余剰インスタンス
    - 性能はオンデマンドインスタンスと全く同じで価格は最大9割引
    - アカウントごとに作成できるスポットインスタンスの上限が決まっている(default:20)
    - 削除しても作成時に存在しているかように振る舞う時がある
    - スポットインスタンス枯渇問題
      - スポットインスタンスはAWSの余剰スペースを使うので、余剰がない場合は利用できない場合がる
      - オンデマンドインスタンスを使うRunnerを作った
  - Docker Machine
    - Docker Engineを異なるホストに作成することができる
    - Rancherみたいなもん？
    - Serverless Framework
      - TeraformでAWSLamdaの管理をするのが辛いので助かる

- GitLabにECRを導入した
  - ECR (Amazon ECR)

## ふんわりReview Appsでデプロイプレビュー

- デプロイプレビュー
  - MRごtにその変更内容だけをプレビューできる
  - MRをチェックする時にいちいちgit pullせずとも実際の見た目が確認できる
  - 本番環境にあげる前にスマホで実際に見え方を確認することができる
- Review Apps環境のセットアップ
  - MRごとの環境ホストデプロイ設定をすると理解

## GitLab CI/CDとECS Fargateでリリース作業が楽になった話


## iOSとGitLab-CI

- Travis CI / Circle Ci / Bitriseはどれもクラウドサービス
- iOSアプリをビルドするための証明書を登録する必要がある
- 受託開発では顧客のApple IDを借りなきゃいけないのでセキュリティポリシーの観点でNGになることが多い
  - だからオンプレで構築
- master
  - adhoc/InHOuseビルドを作成

- メリット
  - オンプレ環境で構築したいので社内で完結できる
- デメリット
  - メンテが大変
  - Xcodeのキャッシュを定期的に削除している

## GitLabサーバーのモニタリング

- GitLab Runner の AutoScaring
- Prometheus
  - Gitlab 9.0以降有効になっている
  - Prometheus Expoters
    - 監視対象が色々とある
- GitLab CIの待ち時間が知りたかった
  - Grafaraで閾値を設定して監視しSlackにアラートを出した
- girlab.rbを見ると変更履歴にない変更を知ることができるので定期的にdiffをとるといい

## 新人がGitを使えるようになるために育成レポートをGitLabで管理してみた話

- 