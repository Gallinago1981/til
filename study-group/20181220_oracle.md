# OchaCafe#1 - Kubernetesで作るコンテナベースCI☆CDの夕べ

- @hhirosell
- cndjp
- イントロダクション
  - 新しいビジネスの発見のためのITを活用する
  - ペースレイヤーモデル
    - 新しいビジネスに対応するにはアプリケーションを高頻度で更新する必要がある
    - 失敗したらすぐに切り戻せるようにする
  - 高頻度リリースにおける課題
    - アジャイル開発
    - DevOps
    - インフラの自動構築とCI/CD
    - Microservice
- CI/CD
  - ソースコードの変更から本番環境へのリリースの流れを極力自動化する
  - コンテナの可搬性
    - アプリケーションに与える設定、依存ライブラリなどの状態を小容量のコンテナイメージとしてパッケージング
  - k8s
    - 宣言的オペレーションと環境のコード化
  - 残課題
    - CIツール側で全てのでプロ先との連携設定を管理する必要がある
      - 一度設定すれば終わりではない
    - セキュリティのリスク。CI
      - ツールがAttack Surfaceになる
      - CIが攻撃されると本番環境への攻撃につながる
    - manifestが現在の環境を表現しているとは限らない
      - パイプラインの実行順序が保証されるとは限らない
    - オペレーションにCIツール固有の操作が入り込む
      - デファクトのCIツールの不在、学習コストが増える
      - 最悪主導が増える
- GitOps
  - とは
    - CDを行うっための手法の一つ
    - 2017年にweaveworks社によって提唱された
    - CI/CDを分離できる
      - CDはCIツールに依存しない
  - 実践

- GitOpsを実現するツールの紹介
  - CIツール
    - Jenkins, CircleCI, ConcourceCI
  - manifestテンプレートエンジン
    - Helm, Ksonnet, Kustomize
  - 差分検出と反映
    - Spinnaker, Weave Flux, Kubediff
- ブランチ戦略とGitOpsパイプライン
  - ブランチと環境とを1対1の方がシンプルでやりやすい
  - パージョンごとのブランチを維持していくのは難しい
    - バージョン管理が必要なシステム(v1.0, v1.1とか)
- single source of truthにテンプレートエンジンを利用する

- Wercker
  - コンテナベースの開発に対するCI/CDサービス
  - 成果物はコンテナとしてビルド
  - 直感的な操作で利用できる
- Helm
  - k8sのパッケージマネージャ
    - yumとかaptとか
    - k8sへのソフトウェアの展開を行う
    - 依存関係の整理
- Spinnaker
  - 継続的デリバリツール
  - Netfilixで開発されているOSS
  - 様々なインフラ環境を抽象化してデプロイ先を選べる
  - インテリジェントなデプロイ方式を複数サポート
    - ローリング、red/black, カナリアリリース

- Demo
  - 