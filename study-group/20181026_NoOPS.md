# NoOps Meetup

## NoOps

- NO Uncomfortable Ops
  - システム運用で嬉しくないことを減らそう
  - おさらい
    - Pulickeyで記事になっているよ
    - MSの真壁さん(Opsの味方)
    - Opsは役割じゃない
    - べき論はやめよう
    - 初めてやることをdisらない
    - 止めることが一番大変
    - NoOpsは「止めるファースト」
    - NoOpsは運用止めるじゃない。サーバ増えたら仕事量が増えるのは違うよね
    - NoOps -> BestOps
    - Applicatio層と
    - knaitveとか使ったらええんじゃない
    - 真面目にSREやってたらNoOpsになるよね
    - 人間がやるべきことに注力するために「やること」を決める
    - チームがやることを増やす
    - 機械ができることは機械でやろう
    - 堅牢さ=信頼さ -> 取り回しの軽さ=Resiliency
      - インフラだけに持たせても意味がない。アプリ側も必要
    - 非機能要求のハードルをとことんあげたらいいんじゃないか
  - おさらいまとめ
    - "止める”ことを決めることが大事
    - NoOpsに向かう準備は整っている
    - みんな違って、みんないい

- コミュニティの指針について
  - 知の共有
    - 現場の経験を共有する
    - ちょっと足りない、できると嬉しい
      - OpenHackでのものづくりをしOSSとして提供する
  - OpenHack.trial
  - オープン、フェア
  - 共感駆動のSRCAサイクル
  - 共感 -> 尊重 -> 貢献 -> 感謝 -> 頭文字でSRCA
  - OpenHackのテーマは
  - サポータ
    - コミュニティへの貢献していただいた方に対し感謝と尊敬の念を込めて「サポーター」と呼ばせてください
  - noopsjp30

## マイクロサービスでのNoOps戦略

- NoOpsとは
  - ITサービスのライフサイクルを早くする
  - 企画、実装、リリースし、利用してもらいフィードバックをもらう
  - 始まりはアジャイル(2001)
    - プロセスやツールよりも、個人と対話
  - DevOps (2009)
    - スクラムのユーザストーリーを実現するためのうんちゃら
  - NoOps(2011)
    - DevOpsは協業
    - NoOpsは自動にフォーカスを当てる
    - アプリケーション開発は運用担当者と話す必要はない
  - Ops. DevOps And PaaS (NoOps) at Netfilx
    - ビルド＆デプロイ自動化ツールを開発し、リリース作業は開発者がコンソール操作をするだけ
  - Why 2012 is the year of 'NoOps' for programmers
  - NoOpsの総論
    - 運用作業の自動化とツールか
      - 自動化とツール化を担当するエンジニアがいる
      - PaaSであれが自動化の基盤が提供されていて便利
  - 開発者はツールを使う運用を行う
  - NoOpsが変えたこと
    - 「作る」と「動かす」の距離がなくなる
    - 運用作業がツールかされてることで役割分担が変わった
    - 開発者がアプリを納品していたが、サービスをリリースしているという意識が必要になった
    - 非機能要件も意識する必要が出てきた。機能要件だけじゃダメになった
  - マイクロサービス(2014)
    - サービス全体を留めずに一部を変更する
      - それぞれの変更の発生タイミングはバラバラ
    - 変更発生単位に”サービス”として分割し、APIde連消させることが変更じにサービス全体を止めない
  - マイクロサービスにNoOpsは織りこみ済み
    - 運用作業の自動化/ツール化というのは重要な土台
    - アプリを動かすからサービスを動かすへ
    - 「うちはAWSじゃない」「既存のツールが」は思考停止
      - DevとOpsとか言う立場関係なく真剣に考えるべき

- サービスを管理せよ
  - 障害から自動復旧
  - ミドルウェアのバージョンアップ自動化
  - Lv はCI/CDができていること
  - アプリとインフラを一体で管理する
    - インフラを用意して、アプリをインストールする
    - PaaS / コンテナ
  - PaaS
    - マネージドインフラ＆ミドルウェアを利用する
      - 便利になればなるほど、制約が強くなる
  - コンテナ
    - ネットワーク/ミドルウェアも含めた構成のバージョン管理
    - ミドルウェアなどに制約なし
    - コンテナ対応PaaSを利用すると便利
  - バッチサーバ入らない
    - バッチジョブを起動するタイミングでインフラを調達
    - バッチジョブ単位でスケール設計が可能
      - 一時的にDBをスケールするサービスもあったりする

- ありがちな課題の解決
  - 固定IP/ドメイン全体
  - エージェントが必要
  - 設定ファイルで環境切り替え
    - 設定をリポジトリ化して起動時に取得してくるようにしましょう
  - データベース関連が主導

- その先
  - k8s, Istio

## ITインフラの NoOps を実現する戦略と方法論 

- ITインフラをターゲットにした話
- 戦う階層を変えること = NoOps
- 変化することが前提の時代
- 戦術のみをしって戦略を知らざる者はついに国家をあやまつ
- Agile侍 -> DevOps忍者 -> NoOps将軍
- https://wwww.sidershare.net/irix_
- 戦略とは状態を作ること
  - クラウドファースト
  - コンテナファースト
  - 自動化ファースト
    これらは、全部状態の話で、まずクラウド｜コンテナ｜自動化を前提に検討する状況
- NoOpsへの戦略アプローと
  - モデルとなる状態を定義
    - 他の成功事例を元に現在の自分たちの状態を比べギャップを確認する
    - ギャップを分析に解消可否が含まれる
    - それらを加味して、最大限どこまで引き出せるかを知る必要がある

- ギャップの測定
  - バリューストリームマップで現状を可視化して比較する
  - 差がどれくらいあるのかを知る
  - すぐに解消できるギャップ、今は難しい、絶対にムリ

- 自動化の戦術
  - 簡単にできそうなものから組み込んでいく
  - 自動化を機械化して別の人に実行してもらう
  - 自動化が増えるとボタンが増えるので連結していく

## なかなか楽にならない証明書の話

- SSL/TLS証明書の管理、しんどくない？
  - 1年1回更新が必要
  - 特殊な致死は必要ないので誰にでもできる

- 非常に重要で簡単な作業なのに自動化があまり行われていない

- 証明書発行の流れ(DV)
  - 認証局に作成したCSRを投げる
  - ドメインの所有を確認する
    - whoisに登録されているメールアドレスにリンク送信
    - 指定されたファイルサーバに置く
    - DNSで指定されたレコードを追加
  - 証明書が発行される
    - 中間証明書と一緒にサーバーに配置したり、PFXにしたり

- 自動化されない理由
  - 知事に手順化が難しい手順ばかり
    - CSRの作成、ドメイン所有の確認、証明書と秘密鍵の配置
  - 証明書の期限はだいたい12ヵ月
    - 頻度は少ないからどうでもよくなっちゃう
  - そもそも認証局が自動化前提の作りになっていない

- 楽にしようとする動き
  - クラウドベンダーが認証局をもつ（AWS）
    - ELB / ALB / CloudFront / API Gatewyで使える
      - ワイルドカード証明書も発行できる
    - 自動的に証明書の更新をしてくる
    - ドメインが利用中かつSSL/TSLで外部からアクセスが可能な状態
      - IP制御されていると更新されない
        - メールが送信されてくるので踏まないと更新されない
    - 無料で使えるのが偉大

  - 外部の認証局とパートナーシップを結んでいる（Azure）
    - DigiCertとGlobalSignと連携している
      - あらかじめサインアップしてアカウント情報を追加して置く
      - 事前に指定したポリシーにしたがって更新してくれる
    - 自己署名証明書の発行もできる
    - おそらく有料

  - Let's Encryptを利用している / ACMEプロトコルの導入
    - GCPのManaged SSLなどが数多い

  - certbot が使えるケース
    - nginx や Apache を直接後悔している場合に使える
    - Let's Encrypt公式クライアントなので安心

  - キー管理について
    - HSM Hardware Security Module
    - AWS は　KMS / CloudHSM

  - Web Apps専用
    - https://github.com/sjkp/
  - App Service向け
  - Key Valut向け
  