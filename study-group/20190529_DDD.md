# DDD(Domain Driven Design)実践の現場

## ドメイン駆動設計の正しい歩き方～どこに焦点をあわせ、どう実践するか

- スライド
  - <https://www.slideshare.net/masuda220/ss-148093123>

- ドメイン駆動は、進化を続けるソフトウェアを手に入れることができる、変更を楽にできる
  - 狙いはビジネスの進化に対応できること
  - 全てのソフトウェアが進化し続けていくとは限らない

- ドメイン駆動設計とは何か
  - DBとかと紐づけとかが見られるけど、ドメイン駆動設計の話なの
  - ソフトウェア設計としては正しいけど、ドメイン駆動の本質とはずれている気がする

- ソフトウェアの核心にある複雑さ
  - 複雑には色々な要素が関連する
  - ビジネス活動が複雑なのだからソフトウェアも複雑になる

- ビジネスルールが複雑さに直結する
- 複雑さの核心に踏み込むことで周辺コードがスッキリする

- コンテキストマップ、協会づけられたコンテキスト
  - ここの切り分けができても、複雑さの核心なのか？
  - ビジネスを継続的に学び続け、コアドメインに集中する、ビジネスを深く洞察することができるか？
    - コマドメインを選び抜き集中する
    - ビジネスの理解が浅いとコアドメインが選びきれない

- 6の問い
  - ビジネスの活動を継続的に学んでいるのか
  - コアドメインに集中しているのか？
  - ビジネスを深く洞察しているか
  - ドメイン層を独立させているか
  - モデルと実装を密に結合しているか
  - システム間の秩序の改善を続けているか？
    - 障害対応、納期直近にこれらを意識して開発し続けられているかが大切

- 正しい道を外れてしまう
  - ビジネスの活動から目をそらす
  - 全体を均質にカバーしようとする
    - ありとあらゆるものを値オブジェクトにしようとしてたりしないか？
    - コアドメインに集中できてない
  - ビジネスを表面的にとらえて理解した気になる
  - ドメイン層に入出力の関心事を持ち込む
    - 複数のテーブルから集計した結果っていうのはコアドメインではない
    - コアドメインはもっと複雑になる
    - 合計金額を算出するために様々なオブジェクトが関わっている
  - モデルと実装を切り離す
    - モデリングは楽しい。綺麗にできるとスッキリする
    - ビジネスを理解するにあたって綺麗にできていることは意味があるが実装とかけ離れていると役に立たない
    - 実装はモデリング結果に比べて綺麗にならない
    - コードを綺麗に書くにはどうモデリングすべきかでモデルの話をしていくのもあり
  - システム間を力づくで連携させる
    - 一度連携させて満足してはならない
    - 常にシンプルに効率が良い連携方法を模索し続けることが大事

- ホテルの予約アプリケーションの事例研究
  - 独立とは、独立したドメインだけでテストができること
  - 画面とかDBとかデータ入手力を一旦忘れて料金計算という方法に特化した考えること
  - 料金モデルとコードのどちらかを作り上げるのではなく、行ったり来たりしモデルとコードを成長させていく
  - 軸の撮り方は実験
    - シーズン？客室タイプ？
    - 候補が３つあるなら３つともコードを書いてみたらいい
    - 完璧に作る必要なんてない
    - プロトタイピングは重要
  - 与えられたものをわかった気になっている間は理解が浅い
    - 歯抜けの仕様書を渡された時に埋めることができるかが重要
  - 単純なCSVファイル連携でもただ連携するだけではなく、どう連携することで業務効率が上がるかなどの検討をしていくことが大事
  
  - ドメイン駆動設計で作ることはどういうことか

- 「エヴァンスの文章スタイルになれる」
  - 想定要件をクリアする
    - オブジェクト指向ソフトウェアの開発者
    - UMLとJavaの基礎知識を持っている
    - オブジェクト指向モデリングの若干の知識
      - 2000年前半のモデリング設計は全く役に立たない
      - 歴史が証明されている
      - DBの概念モデルの焼き直しに近い
      - 端的にいうとメモリ上の値をどう管理するかであって現実世界を持ち込むことはやめたほうがいい
    - エクストリームプログラミングを知っている
      - モデルとコードを行ったり来たりしていくことが近い
    - オブジェクト指向設計の何らかの知識
    - オブジェクト指向設計の文献を1,2冊は読んでいる
      - ラーマンの実践UML

- 28ページの抜粋版
  - ドメイン設計の要約版
  - きちんと読んだほうがいい

- 全体像をちゃんと読む
  - 1, 2部は導入
  - 3 ,4部をちゃんと読む

- 実践ドメイン設計
  - 4,5,6, 全部
  - 13, 14　ピックアップ
  - ドメイン駆動設計の1/4しかサポートされてない

- 読むべきは第9, 10章
  - 行ったり期待することで深い洞察を得ることができる

- エヴァンスの文書スタイルになれる
  - いきなり現れる経験談はスキップしたほうがいい
  - 他の事項との関連性の説明
    - 話が発散したり焦点がぼやける補足説明

- ドメインエキスパートとのコミュニケーション
  - ちゃんと説明されることはない
  - 聞き方はある
    - 具体例と共に持っていく
    - 間違っててもいい

- 決定権持っている人へのアクセス
  - 変更が楽になることで変更が発生してもダメージが少ない
  - 

## モデル駆動型開発によるビジネスをソフトウェアに落し込む１つのやり方

- 背景
  - ドメインの背景をしる
  - Java * DDDの濃い環境
  - 世界のプロジェクトは全て炎上しているのか？
  - モデリング
    - ビジネスモデル・キャンパス
    - RDRA
  - ビジネスとソフトウェアの中間言語としてのモデル
  - MDA(モデル駆動アーキテクチャ)
    - CIM (システムから独立したモデル)
    - PIM (プラットフォーム独立モデル)
    - PSM (プラットフォーム固有モデル)
    - コード
    - 廃れた理由
      - 仕様がふわっとしていた
      - 色々とふわっとしてた
- mars(火星)
  - アクティアで開発しているプラットフォーム
- 当初取り組んでいたモデル駆動開発
  - モデルからコードの自動生成
  - グラフィカルだとみた感じ分かりやすいが差分が取りにくい
  - 静的な構造はコード化しやすかったが、動的な構造は表現が難しい

- 言葉との戦い
  - ユビキタス言語は値オブジェクトやエンティティに落としやすい

- 貧血との戦い
  - 抜けられない染み付いたやり方
  - ドメイン設計
    - トランザクションスクリプトになりがち
    - 入出力の関心ごとに引っ張られる
    - ドメイン層がスカスカになってデータを持ち回すだけの器になりがち
    - パッと見はドメインモデルに見えるけど、ドメインモデル貧血症におちいりがち
