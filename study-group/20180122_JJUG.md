# JJUG_201801

## Webサービスのモニタリング
### モニタリング
* アプリケーションでも大切！
* WEBサービスは生き物
* 変化している成長している
* 色々な影響を受ける

### Mackerek
* 直感的サーバー監視サービス
* 5台まで無料

#### サーバサイド
* サーバサイドに置くのが一般的
* リクエスト監視、サーバ死活

#### クライアント
* アプリやブラウザ(JavaScript)の性能
  -> モニタリングしてる？
  -> 意図しない挙動が発生する
  -> Android端末のバージョンにより挙動不正
* モニタリングしないと原因が究明できない
* プロトコル
* websocket/http2

#### ネットワーク
* BGP
* DNS
  .IOが落ちたとか

  -> コントロールできないからモニタリングが必要
  -> オペレーターへの通知が早くなれば一時対応がよくなる
* レイテンシー
* スループット
* 名前解決出来ているか

### 可視化
* ↑のを知ることでグラフ化され状況が可視化される
* サービスの可視化
- PV/訪問数, ダウンロード数, ユーザの利用量
- はてブが増えればはてブろのオートスケールの設定を見直すまでの猶予ができる

### モニタリングの勘所
* 適切なリソースが使えているか
* 意図しない挙動に気づく
* グラフの挙動がおかしくなれば気づける
* 変化の差分があるから気付ける
* リリースによるアクセス過多なのかを気付ける
* キュー数
* たまり過ぎている場合は要注意
* リソース上限の予見ができる
* DNP, NTPの状況
* ユーザの検索ワード
* 利用OS

### サービスのかしかTIPS
* Twitterで「○○重い」
* 問い合わせ回数の可視化
 -> ユーザ起因のを可視化することで問題への気づきが早くなる
* issue, taskの可視化
* 自分のサービスの外も可視化する
-> Twitterなどのユーザ起因の情報が重要な場合もある
* 改善のサイクルが見えるようになる
-> モニタリングの内容を定期的に精査
-> 誰も見ない監視は意味がない
-> インフラで出来ることは少ない
-> リリース -> 確認 -> 問題検知

### 知って得するTips
* loadavg
実行待ちのプロセスの数
ディスクのI/O待ちのプロセス数
~~
$ uptime
1分, 5分, 10分間隔の順でわかる
~~
スパイクしている
平常時に落ち着くことが大切

* CPU
CPU利用率の割合を知る
- cpu.user - アプリの改善またはCPUの性能をあげる
- cpu.iowait - disk io待ち
- cpu.system - カーネルが使用している割合(システムコール)
- cpu.idel - I/O待ちがない

* DISK I/O
discのメトリクスでread/writeを確認

### JVMのモニタリング
* 1週間のグラフと見比べることで、負荷が高いタイミングなのか異常なのかを予見できる
* JVMがブラックボックスされているのでモニタリングすることで明るみになることもある
* ニューレリック new relic

### まとめ
* まずは可視化
* aws データトレック
* 推測よりも計測
-> 線で見ることが大切
* 事実をより多く正しく知ることで未来を正しく予測できる
* SREトライアビリティエンジニアリング
-> おすすめ

* テストコード: プログラムの品質の可視化
* 監視 : サービスの品質の可視化
* 体重計に乗るだけでは痩せない
* 品質を可視化しただけでは改善されない

## Kotlin
### Kotlinとは
* 静的型付けオブジェクト指向言語
* Javaとの親和性が高い

### Kotlin1.1
* コルーチン
  関数の中断、再開
* async/await
  非同期処理を同期的に記述できる
  callback地獄からの解放
# 別名
  DBで言う所のdomain

# データクラス, シールドクラス制限緩和
* 継承が可能になった
* シールドクラス? 

### KotlinConf 2017
* マルチプラットフォームに対応(JavaScript/JVM/Nativeはそのうち)
* サーバーサイドKotlinが熱い！

### Kotlin1.2 (2017/11)
* マルチプラットフォームプロジェクト
ビジネスロジックをサーバサイド、フロントで共有する
View, Entityなど共通的な定義を共有できる
宣言の共有もできる(interfaceのようなもの？)

common -> platform(jvm)-> regular(JVM)
common -> platform(JS)-> regular(JS)

common - kotlin native

jvm - system.out.println
js  - console.log

などの違いを吸収する

* 配列リテラル
アノテーションの引数に配列リテラルが使えるようになった
コードではかけない

### KotlinでWeb
* SpringFramework 5 からKotlinフレンドリ感がアップ
* Spring WebFluxの追加
* ラムダを利用したBeanの登録

### Exposed
* SQL DSL
* Data Access Object
-> RubyのActive Recordみたいなやつ

* Kt    ro JetBrain社作成のマイクロサービス向けフレークワーク

* Androidだけじゃなくてサーバサイドでも使えるよ！


