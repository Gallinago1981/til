# 20190215 devsumi

## OSS活動のやりがいとそれから得たもの(PostgreSQLコミュニティにて)

- PostgreSQLコミュニティ
  - ユーザ会ではなくOSS開発コミュニティ
  - オープンな開発体制
  - 合意を基本とする意識決定
    - 全会一致ではない

- OSS活動
  - ミートアップ、カンファレンスへの参加、登壇
  - ドキュメント改善
  - バグ報告
  - バグ修正
  - バッチのレビュー
  - バッチのテスト
  - 新機能開発

- バグ修正、軽微な機能改善
  - 技術サポート対応で出てくる問題や検証作業なので不憫と感じた点を治すことが多い

- 製品の開発動向に詳しくなった
  - メンテされていない機能がなんなのかがわかるから利用可否の判断が早くなった

- 気をつけないといけないこと
  - 英語でのコミュニケーション
  - 評価してもらえる仕組みが必要
    - レビューは成果に入るのか？
      - PostgreSQLコミュニティのレビュワー不足
  - 成果が出るまで長い時間がかかる場合がある
    - 分散トランザクションの開発を3年くらいやってるけど、まだまだ入っていない
  - 会社・上司の理解が不可欠

- OSS活動のススメ
  - まずはミートアップへの参加
  - バグレポートを送る
    - 利用者目線でパッチを送る
  - バグを修正する
  - 新機能を開発する、レビューをする

- 秘蔵のパッチ、眠っていませんか？
  - ドキュメントの不備に関する知見があるのであればフィードバックした方がいい
  - 変な挙動に合わせたツール
    - 長い目で見ればOSSに入った方がいい
  - 独自のパッチを当てている
    - 本体にマージされた方が効率がいい

- Qitta PostgreSQL開発の基本動作まとめ が投稿されている



## CI/CDを使い倒して数段上のソフトウェア開発をしよう！

- パブリッククラウドがCI/CDを続々と発表している
- なぜ、CI/CDが関心が高まっているのか？
- CodeZineでCI/CDに関する連載があるよ「

- what
  - なぜテストを書くべきか
    - なんども同じ手順を繰り返さないといけない
    - 人の目と手に頼ると必ず見落としが発生する
  - CIとは
    - 開発者へのコード変更に対してテストを同じ環境で事項できる
- why
  - テストを書くだけでは不十分
    - テストがあるけど実行し忘れた
    - 昔かいたテストが壊れていて動かない
    - テスト結果が環境依存
  - テストの実行忘れ
    - リリース前にテストをし忘れる
    - バグを見落とす
  - テストが壊れる
    - テストが失敗した原因がテストがダメなのかソースがダメなのかがわからない
    - テストへの信頼性が下がる
  - 壊れたテストを素早く検知
    - 直さないとマージできない
  - 使われていない自動化は壊れていく
  - テスト結果が環境依存
    - 環境によってOK/NGが別れる
    - テスト環境の差異による問題
      - ローカルDBに残っている不要データのせいで本来NGになるべき結果がOKになってしまう
    - テストを毎回同じテスト環境が構築される
    - Dockerなどのコンテナを利用し再現性のある環境を構築する
  - テストの新陳代謝を高めて信頼性をあげる


- why not (問題は何か)
  - CIの導入を妨げる問題
    - でも実行するテストが存在しない
    - テスト文化の布教にはコストと時間がかかる
  - テストがなくてもCIを始める
    - お好みのCIツールを選ぶ
    - 様々なタスクを自動化する
      - 構文チェック
      - カバレッジ計測
      - 循環的複雑度のチェック
      - ドキュメントの自動生成
    - 可視化
      - ステータスバッチ
      - ダッシュボードの作成
      - メール・チャットでの通知
    - マージブロック有効化
      - マージするための条件をブランチごとに指定できる機能
      - CIが通らないとマージできない
      - 管理者しかマージできない
    - テストの追加
      - ユニットテストはとりあえず後回し
      - もっとも大事なビジネスロジックのテストから追加していく
      - 無理は禁物。テストしやすいものからテストをする
  - CIのメンテナンス
    - CI/CDツールのメンテナンスは大変
    - 通常専任のエンジニアが必要
      - Jenkinsおじさんがいなくなるとプロジェクトが破綻する問題が発生しないようにする必要がある
    - クラウド型 VS オンプレ型
      - クラウド型の方が、自分たちで運用しないで済むのでランニングコストが減らせる

- beyond CI
  - CD

- what is CD
  - CD (継続的デリバリー)
    - 常にリリース可能な状態
    - リリース作業に人間の意思が介在する
    - デプロイする者は自動で作成するが、人間がどこにどのバージョンをリリースするかを判断する
  - CD (継続的デプロイメント)
    - リリースに人間の意志が介在しない
  - デプロイとリリースの違い
    - デプロイ
      - コードを本番環境に配置すること
    - リリース
      - 配置したコードでトラフィックを裁くこと
    - デプロイはするがリリースはしないリリース方法がある

- よくあるリリース後の問題
  - 検証環境で見つからなかったバグ
  - しようと全然違う動き
- フィードバックループを使おう
  - 細かい単位でリリースする
  - フィードバックを早める
  - カイゼンする
  - CIなしだとループが回らない
    - No CD, No Feedback Loop

- なぜCI/CDへの関心がこれほど高まっているのあ？
  - テストの品質が開園させることでプロダクトの品質向上が期待dけいる

- Why NOT CD
  - 技術的な問題
    - CDが向いていないアーキテクチャ
      - エンタープライズなアーキテクチャー
      - レガシーなアーキテクチャ
        - サービスが密結合している
    - 時間をかけてアップデート
      - サービスの疎結合
      - 徐々にモダン化
  - 組織的な問題
    - SKIP
  - 新システムの導入はCI/CDから始めよう(最初からクライマックス)

- CircleCIでの事例
  - Before
    - つねに200台以上のビルドマシンからなるフリート
    - ChatOpsでデプロイ
    - およそ2日で完全に入れ替える
    - しばらく古いコードと新しいコードが混在する問題
  - After
    - Dockerとk8sの導入
    - マイクロサービス化
    - CI/CDの会社でも1年かかった

- CDのまとめ
  - CDが回るとフィードバックループもまわる
  - CDに向いていない組織は存在する

- CDのその先1 迅速なロールバック
  - 問題のあるソースはrevertすることでリリースが可能
    - コンテナイメージの差し戻しでもいいよね？
  - 本番環境でのテスト
    - １週間テスト環境でテスト -> リリース -> 本番環境とステージング環境でDockerのバージョンが異なりDockerのバグを踏む
    - テスト可能な部分は小さい
  - リリースしてみないと結局わからないことが結構多い
  - 高度なリリース手法
    - カナリーリリース
      - 変更を本番環境の一部に適用する
    - ブルーグリーンデプロイ
      - 本番環境をブルー、グリーンを２つの環境を設ける
      - ルーターでトラフィックをどちらの環境にするかを仕分ける

- まとめ
  - プログラミングに対する圧倒的な心理的安全

- CI/CDの未来
  - CI -> Cdelivery -> Cdeployment -> ???
  - 今手動でやっていることを意識しなくてもいい時代
  - ファーストコミットした時点でCI/CDの環境が構築されていることかも？

## OSS開発スタイルを取り入れて、効率的な開発を！～InnerSourceのススメ～

- 社内のドキュメントのリンク切れを発見
  - PRを出したが自分は誰が対応するかしない
    - レビュワーが自動で設定された
    - CIが走った
    - botが目次を自動生成
- 社内でOSSを実践
  - 貢献できる喜び
  - 重複した無駄な作業がない
  - 高い生産性

- InnerSource
  - 社内でもOSSのようなやり方を行う方法をこう呼ぶ

- 奇病のソフトウェア開発が抱える問題
  - ソースコードやドキュメントが感単位検索できない
  - 組織内の知識共有がうまくできない

- ライブラリの修正が行われると、関連しているチームに対しお伺いを立てるなどのコミュニケーションコストが高い
- InnerSourceとはオープンソースのベストプラクティスを取り込む
- InnerSourceのコール
  - コードの再利用
  - チームを跨いだコラボレーション
- どう実践するのか
  - ツールは文化を変える触媒
  - ツールを導入することでそれを使う人の行動が変わる
  - それが文化を変えるきっかけとなる

- 情報を共有する基盤を統一する
  - 他の人が見えることができるようにしないと始まらない
    - 統一された基盤の上で、ソースやドキュメントを置く
    - Privateにする明確な理由がない限りPublicにする
  - あらゆるコンテンツにURL
    - 過去の議論がIssueなどに残っていると、以降により良い提案ができる可能性がある

- コントリビュートの仕方を明確にし敷居を下げる
  - チーム外からのコントリビュートを歓迎していることを明記することで心理的な敷居を下げて勢いを与える
  - 具体的な手順を明記する

- リポジトリのROOTにCONTRIBUTING.mdを置くといい
  - やり方を明記することが大切
  - js-primer 

- ワークフローの自動化
  - 変更ないようによてレビュアーが自動で設定
  - PRがま＾時可能となる条件の明確化

- CODEOWNERS
  - CODDOWNERSをROOTに配置
  - ファイルの種類やディレクトリごとにオーナーを指定できる

- CI + Protected Branch
- Github pages
- Github Actions
  - 2/14 devsumiで話してあるよ
  - CI/CDに使えるよ
  - CI/CD以外にもいろんなイベントハンドラーがあるからね
  - マージずみのブランチをbotで消すこともできるよ
- InnerSourceはPayPalが作り出した言葉


## Site Reliability Engineering at Google

- SREとは
  - Googleのシステム運用チームが考えたやつ
  - Google以外の企業ではマッチするかはわからない
  - ソリューションアーキテクト
    - GCPのサポート
    - GCPを利用しているユーザ様にとって役立つことを提供すること

- Google のグローバルインフラストラクチャー
  - Googleのミッションステイト
    - 世界中の情報を整理し、世界中の人々がアクセスできて使えるようにする

- Googleのインフラは世界各国にあるデータセンターを専用線で繋げている
- 共通ミドルウェア
  - 分散ロックマネージャとはなんぞや
  - BigTable - 分散NoSQL
- GCPはGoogle社内でのミドルウェアをパブリッククラウドとして後悔したもの
- SRE: ソフトウェア開発者によるシステム運用
  - 「安定的にサービスを提供すること」を目的としてソフトウェア開発者に考えされた
  - 50%ルール
    - ソフトウェア開発を含む、システム安定化に関わるプロジェクト活動に充てる
    - SREチームはルールを脅かすシステムに対s知恵は開発チームhねの運用作業の返却もしくは運用要員の提供を要求する権利を有する



## サーバーレスで最高に楽しめるアプリ開発 

- サーバレスは開発を高速に行える
- インフラ環境はクラウドにお任せ
- キャパシティもスケーラビリティもログもクラウドにおまかせ
- アプリのプロトタイピングとかでも有効
- アイディアをすぐに形にできる
- PWA
  - ブラウザでアプリっぽく作れる？
- アプリ開発に専念できる楽しみ
  - 実行ランタイムを手軽に扱える
- エンハンス
  - マイクロサービス型のアーキテクチャとして機能を追加
  - 15近いマイクロシステムを構築
  - IPアドレスを固定するのはVPC Lamda
- AWS Lamdaのステップが多すぎて遅くなってしまう
  - Lamdaのコールドスタート問題(起動が遅い)
- ピタゴラ装置
  - DynamoDB TTL -> Timeoverのイベント発火？


## GKEとIstioで構築するクラウドネイティブ・アプリケーション - What, Why, Where and How to use Istio?

- istioが登場した背景
  - ソフトウェアが世界を飲み込む
    - デジタル化が行なっている
    - 実店舗で行われていた商売がネット上で行われるようになってきた
    - システムは業務効率を向上させるものからビジネスの中心になってきた
    - 競争優位を確立するため顧客ニーズを満たす必要がある
    - 分散ワールド
      - スケーラビリティ、可用性の向上
      - クラウド、プラットフォームとの相性の良さ
    - モノリス vs マイクロサービス
      - k8s, istioが注目される背景の１つ
  - クラウドネイティブ
    - Biz ビジネス
      - 顧客接点となるアプリケーションは停止時間が最小限
    - Dev 開発
      - 任意のコードで開発できる
      - 足回りを気にしなくていい
      - アプリケーションロジックにフォーカスする
    - Ops 運用
      - 自動化、Toilを取り除く
      - 観測性の確保
      - 宣言型API
    - 本当に自分たいに必要なの？
      - 各要求を満たそうとするとクラウドネイティブへ流れていくのは自然な流れ

- istioとは
  - サービスメッシュと呼ばれるソフトウェアレイア
  - コンテナおよびVMにまたがるサービス感通信を管理するためのオープンプラットフォーム
  - アプリケーションロジックをネットワーク機能から分離
    - マイクロサービスのサービス間で生じる障害に対してのアプローチ
    - エラー時へのリトライなどを行う
    - 上述の内容をアプリ側から取り除くことができる
  - Istioがもたらすかち
    - フォラフィックコントロール
      - Istio以前
        - インフラストラクチャに結びつけられたトラフィックコントロール
        - 10％がCanarry ロードバランス
          - LBは平等に分散んするので、旧バージョン9台、新バージョン１台をそれぞれ用意する必要がある
        - k8sではトラフィックコントロールをするすべを落ち合わせない
      - Istio 以後
        - 90%のトラフィックを既存へ、10%のトラフィックを新規

    - 可観測性
      - 障害時の接続経路を記録する
      - CPU利用率、IO waitの敷居値を超えたら通報する仕組みだったß
    - セキュリティ
      - 自動 sekyurity
      - どのように動くのか
        - サイドカーコンテナ
        - サービスアーキテクチャ
  - Istioの全体像
  - GKEはIstioを有効にすると利用できる
  - BigtableやCloudSQLへのアクセスする際のリトライにIstioは使えるのか？
    - できるはず！
  - k8sのingressとistioのingressは同じか？
    - 異なるもの
    - IstioはL3, L4を担う？
  - GKE内にSREの概念が取り込まれているようだ
  - クラウドネイティブ化はアプリケーションを支えるための新しい基盤が登場している
  

## アウトプットのススメ　～技術同人誌・LT登壇・Podcast～

- 技術同人誌を書こう
  - メリット
    - 技術の棚卸しができる
      - 理解している部分とできていない部分がはっきりする
      - 構成 -> 調査 -> 執筆 の循環
    - アウトプットの規模がちょうどいい
    - 全部自分でできる
      - マーケティング、構成、執筆、組み版、頒布
    - 商業かもワンチャンあり

- アウトプットって何
  - アウトプット - 無意識を意識する
    - 言葉によって伝えるもの
    - 文書によって伝えるもの
    - コミュニケーション
    - その他
      - 行動仕草、金銭の消費
  - アウトプットは無意識に行なっている。意識してみたらどうなるのか
  - 選択的注意
    - カクテルパーティ効果
      - 周囲の環境がある環境下で自分に常用だと認識された情報だけを選択して注意を向けること
  - 無意識に行なっているインプット/アウトプットを
  - アウトプットのコントロール
    - 何に意識を向けるかがすごく重要
    - どうな言葉
    - どんな行動

- 技術同人誌から変わる世界
  - @hekitter

- 井の中の蛙
  - 長村ひろ
  - 形としてのアウトプット
  - 感情のアウトプット
  - 経験のアウトプット

- podcast
  - @higuyume
  - なぜpodcastを進めるのか
  - 自分でpodcastやらない
    - コミュニケーションに声は必要じゃない？
  - なぜpodcastを複数
    - お仕事am
      - 話す力を育てている
    - そのほか
      - 聴く力を鍛えている

- 今日からアウトプットを始めよう
  - @erukiti
  